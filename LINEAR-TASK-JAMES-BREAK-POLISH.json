{
  "title": "üîß Polish Break System - 3 Outstanding Features",
  "description": "## üéØ YOUR MISSION JAMES\n\nFinish polishing the **Break Tracking System** that Stephen built. The core system is **95% complete** and working perfectly. You just need to add 3 finishing touches!\n\n---\n\n## ‚úÖ WHAT'S ALREADY DONE (DON'T TOUCH!)\n\n### **Core Break System** ‚úÖ\n- ‚úÖ Full-screen break modal with countdown timer\n- ‚úÖ Pause/resume system (one pause per break)\n- ‚úÖ \"I'm Back\" popup when break ends\n- ‚úÖ Scheduled breaks with auto-start\n- ‚úÖ Manual breaks (Morning, Lunch, Afternoon, Away)\n- ‚úÖ Break scheduler modal\n- ‚úÖ Timer accuracy (no negative numbers)\n- ‚úÖ Database integration (all breaks logged)\n- ‚úÖ Break button visibility fixed\n- ‚úÖ Auto-start at scheduled time (checks every 15 seconds)\n\n**All tested and working!** Check `BREAK-SYSTEM-COMPLETE-OCT-15-2025.md` for full docs.\n\n---\n\n## üìã YOUR TASKS\n\n### **Priority 1: Away From Desk - Add Reason Selector** üö∂\n\n**Current State:**\n- Away break button works\n- Timer works\n- Shows in manual breaks card\n\n**What You Need to Add:**\n1. **Reason Selector Modal** (before break starts):\n   ```\n   Why are you stepping away?\n   ‚óã Restroom\n   ‚óã Water break\n   ‚óã Phone call\n   ‚óã Other: [text input]\n   ```\n\n2. **Save Reason to Database:**\n   - Field already exists: `awayReason` in Break table ‚úÖ\n   - Store in `/api/breaks/start` route\n\n3. **Display Reason in Break History:**\n   - Show reason next to \"Away from Desk\" in completed breaks\n   - Example: \"Away from Desk (Restroom) - 5 min\"\n\n4. **Allow Multiple Away Breaks:**\n   - Remove \"‚úì Taken\" logic for Away type\n   - Should always show \"Start Now ‚Üí\" (never grayed out)\n\n**Files to Modify:**\n- `components/time-tracking.tsx` - Add reason modal before starting\n- `app/api/breaks/start/route.ts` - Save `awayReason` field\n- `components/time-tracking.tsx` (line 617-625) - Away button logic\n\n**Estimated Time:** 1-2 hours\n\n---\n\n### **Priority 2: Clock Out Confirmation Dialog** üî¥\n\n**Current State:**\n- Clock out modal appears\n- Asks for reason\n- Records to database\n\n**What You Need to Add:**\n1. **Pre-Confirmation Step:**\n   ```\n   Are you sure you want to clock out?\n   \n   üìä Your Shift Summary:\n   - Total time: 8h 15m\n   - Break time: 1h 15m\n   - Net work time: 7h 0m\n   - Clock in: 9:00 AM\n   - Clock out: 5:15 PM\n   \n   [Cancel] [Yes, Clock Out]\n   ```\n\n2. **Validation:**\n   - Prevent clock out if on active break\n   - Show error: \"You're currently on a break. Please return from break first.\"\n   - Add override for admins: \"Clock Out Anyway\" button\n\n3. **After Confirmation:**\n   - Show existing reason selector modal\n   - Then complete clock out\n\n**Files to Modify:**\n- `components/shift-modal.tsx` - Add confirmation dialog\n- `components/time-tracking.tsx` - Check for active break before allowing clock out\n- `app/api/time-tracking/clock-out/route.ts` - Add validation\n\n**Estimated Time:** 1-2 hours\n\n---\n\n### **Priority 3: Auto Clock Out at End of Shift** ‚è∞\n\n**Current State:**\n- NOT IMPLEMENTED\n\n**What You Need to Build:**\n1. **Calculate Shift End Time:**\n   - Use work schedule from database\n   - Example: 9am-5pm shift ‚Üí auto-clock out at 5:00 PM\n\n2. **Countdown Warning (15 minutes before):**\n   ```\n   ‚è∞ Your shift ends in 15 minutes\n   You will be automatically clocked out at 5:00 PM\n   [Dismiss]\n   ```\n\n3. **Final Warning (5 minutes before):**\n   ```\n   üî¥ Your shift ends in 5 minutes!\n   Auto-clock out at 5:00 PM\n   [Dismiss]\n   ```\n\n4. **Auto Clock Out:**\n   - At 5:00 PM, automatically call clock-out API\n   - Reason: \"Shift ended (auto)\"\n   - If on break: End break first, then clock out\n   - Show notification: \"You have been clocked out automatically\"\n\n5. **Prevent Further Work:**\n   - After auto-clock out, disable all buttons\n   - Show message: \"Your shift has ended. See you tomorrow!\"\n\n**Files to Create:**\n- `lib/shift-manager.ts` - Shift end time logic\n- `hooks/useShiftCountdown.tsx` - Countdown hook\n- `app/api/time-tracking/auto-clock-out/route.ts` - Auto-clock out endpoint\n\n**Files to Modify:**\n- `components/time-tracking.tsx` - Add countdown UI\n- `components/time-tracking.tsx` - Disable buttons after auto-clock out\n\n**Estimated Time:** 2-3 hours\n\n---\n\n## üß™ TESTING MODE\n\n**All breaks are currently set to 1 minute for testing!**\n\nLocation: `components/time-tracking.tsx` line 178-183:\n```typescript\nconst durations: Record<string, number> = {\n  MORNING: 1,  // üß™ TESTING (normally 15)\n  LUNCH: 1,    // üß™ TESTING (normally 60)\n  AFTERNOON: 1, // üß™ TESTING (normally 15)\n  AWAY: 1      // üß™ TESTING (normally 15)\n}\n```\n\n**Keep this for testing your changes!**\n\nWhen deploying to production, change to:\n```typescript\nconst durations: Record<string, number> = {\n  MORNING: 15,   // ‚úÖ PRODUCTION\n  LUNCH: 60,     // ‚úÖ PRODUCTION\n  AFTERNOON: 15, // ‚úÖ PRODUCTION\n  AWAY: 15       // ‚úÖ PRODUCTION\n}\n```\n\n---\n\n## üêõ KNOWN ISSUES\n\n### **Issue 1: Away Break Shows \"‚úì Taken\"**\n**Problem:** After first Away break, button is disabled\n**Expected:** Should always be clickable (unlimited Away breaks)\n**Your Task:** Remove disabled logic for Away type\n\n### **Issue 2: Time Format Matching** (MINOR)\n**Problem:** Auto-start uses string comparison (\"1:20 PM\" === \"1:20 PM\")\n**Impact:** May miss breaks if format differs\n**Optional:** Convert to timestamp comparison\n**Priority:** Low (current implementation works)\n\n---\n\n## üìö REFERENCE DOCUMENTATION\n\n**MUST READ:**\n1. `BREAK-SYSTEM-COMPLETE-OCT-15-2025.md` - **START HERE!** (Full system docs)\n2. `BREAK-TRACKER-STATUS-OCT-15-2025.md` - Bug tracking and fixes\n3. `SCHEDULED-BREAKS-FIX-OCT-15-2025.md` - Scheduler implementation\n\n**Optional Reading:**\n- `BREAK-PAUSE-RESUME-COMPLETE.md` - Pause/resume logic\n- `FULL-SCREEN-BREAK-MODAL-COMPLETE.md` - Modal implementation\n- `MANUAL-BREAKS-COMPLETE.md` - Manual break logic\n\n**Key Files:**\n- Main component: `components/time-tracking.tsx` (952 lines)\n- Break modal: `components/break-modal.tsx` (388 lines)\n- Scheduler: `components/break-scheduler.tsx` (145 lines)\n- API routes: `app/api/breaks/*`\n\n---\n\n## üß™ TESTING YOUR CHANGES\n\n### **Test Away From Desk:**\n1. Clock in\n2. Click \"Away from Desk\"\n3. Reason modal should appear\n4. Select reason ‚Üí Break starts\n5. Complete break\n6. Check database: `awayReason` field populated\n7. Click \"Away from Desk\" again ‚Üí Should work! (not disabled)\n\n### **Test Clock Out Confirmation:**\n1. Clock in\n2. Click \"Clock Out\"\n3. Confirmation dialog should appear with shift summary\n4. Click \"Cancel\" ‚Üí Should stay clocked in\n5. Click \"Yes, Clock Out\" ‚Üí Reason modal appears\n6. Select reason ‚Üí Clock out completes\n\n### **Test Active Break Prevention:**\n1. Clock in\n2. Start Morning Break\n3. During break, click \"Clock Out\"\n4. Should show error: \"You're currently on a break\"\n5. Complete break first\n6. Then clock out ‚Üí Should work\n\n### **Test Auto Clock Out:**\n1. Clock in at 9:00 AM (use test data)\n2. Set shift end to 5 minutes from now\n3. At 15 min before: Warning appears\n4. At 5 min before: Final warning appears\n5. At shift end: Auto-clock out happens\n6. Verify reason logged as \"Shift ended (auto)\"\n7. Verify buttons are disabled\n\n---\n\n## üîç CONSOLE LOGS\n\n**The system has extensive logging!**\n\nLook for these emojis:\n- üöÄ Starting break\n- ‚úÖ Break end response\n- üîç Break list updated\n- üïê Checking scheduled breaks\n- üéØ Auto-starting scheduled break\n- üõë Ending break\n- ‚è∞ Timer started\n- ‚è∏Ô∏è Pausing break\n- ‚ñ∂Ô∏è Resuming break\n\n**Use these to debug your changes!**\n\n---\n\n## üíæ DATABASE SCHEMA\n\n### **Break Table:**\n```prisma\nmodel Break {\n  id              String      @id @default(uuid())\n  staffUserId     String\n  timeEntryId     String\n  type            BreakType   // MORNING, LUNCH, AFTERNOON, AWAY\n  scheduledStart  String?     // \"10:00 AM\"\n  scheduledEnd    String?     // \"10:15 AM\"\n  actualStart     DateTime?\n  actualEnd       DateTime?\n  duration        Int?        // minutes\n  isLate          Boolean?\n  lateBy          Int?        // minutes\n  awayReason      String?     // ‚Üê YOU NEED TO USE THIS!\n  createdAt       DateTime    @default(now())\n}\n```\n\n**The `awayReason` field is already there!** Just save to it.\n\n---\n\n## üöÄ WHEN YOU'RE DONE\n\n1. **Test everything thoroughly** (all 3 features)\n2. **Create test report:** `JAMES-BREAK-POLISH-COMPLETE.md`\n3. **Include:**\n   - What you implemented\n   - How you tested it\n   - Screenshots (2-3)\n   - Any bugs found/fixed\n   - Time taken\n4. **Commit & push:**\n   ```bash\n   git add .\n   git commit -m \"James: Break system polish complete - Away reason, Clock out confirm, Auto clock out\"\n   git push origin full-stack-StepTen\n   ```\n5. **Update this Linear task** with results\n6. **Notify Stephen:** \"Break system 100% complete!\"\n\n---\n\n## üéØ SUCCESS CRITERIA\n\n‚úÖ **Away From Desk:**\n- Reason selector modal appears\n- Reason saved to database\n- Reason displays in break history\n- Can take multiple Away breaks (not disabled)\n\n‚úÖ **Clock Out Confirmation:**\n- Confirmation dialog shows shift summary\n- Can cancel clock out\n- Blocks clock out if on active break\n- Admin override works\n\n‚úÖ **Auto Clock Out:**\n- 15-minute warning appears\n- 5-minute warning appears\n- Auto-clocks out at shift end\n- Handles active breaks correctly\n- Buttons disabled after auto-clock out\n- Reason logged correctly\n\n---\n\n## ‚ö†Ô∏è CRITICAL REMINDERS\n\n1. **DON'T BREAK EXISTING FEATURES** - Core system works perfectly!\n2. **USE 1-MINUTE TESTING MODE** - Makes testing fast\n3. **TEST THOROUGHLY** - These are user-facing features\n4. **DOCUMENT YOUR CHANGES** - Add comments to code\n5. **FOLLOW EXISTING PATTERNS** - Match Stephen's code style\n\n---\n\n## üí° TIPS FROM STEPHEN\n\n**Away From Desk:**\n- Look at how shift-modal.tsx handles reason selection\n- Use same pattern for Away reason\n- Simple radio buttons + text input\n\n**Clock Out Confirmation:**\n- Use existing shift-modal component\n- Add new type: \"clock-out-confirm\"\n- Calculate hours from TimeEntry data\n\n**Auto Clock Out:**\n- Check how shift management calculates late time\n- Use similar logic for end time\n- `setInterval` every 60 seconds to check\n\n---\n\n## üìä ESTIMATED TIMELINE\n\n- **Away From Desk:** 1-2 hours\n- **Clock Out Confirmation:** 1-2 hours  \n- **Auto Clock Out:** 2-3 hours\n- **Testing & Documentation:** 1 hour\n\n**Total:** 5-8 hours (1 day of focused work)\n\n---\n\n**THE CORE SYSTEM IS PRODUCTION READY!**\n\nStephen did all the hard work (timer, pause/resume, auto-start, etc.). You just need to add these 3 polish features and we're 100% done!\n\n**YOU'VE GOT THIS JAMES! üî•**\n\n---\n\n**GitHub Branch:** `full-stack-StepTen`  \n**Commit:** `5890129` - Complete Break Tracking System  \n**Date:** October 15, 2025  \n**Docs:** `BREAK-SYSTEM-COMPLETE-OCT-15-2025.md`",
  "priority": 2,
  "assigneeId": null,
  "teamId": null,
  "projectId": null,
  "labelIds": [],
  "estimate": 8
}

